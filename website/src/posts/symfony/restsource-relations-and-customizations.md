---
title: RESTource relations and customizations
date: 2010-11-15
tags: [post, tech, php, symfony]
layout: post-layout

permalink: post/1581698750/restource-relations-and-customizations/index.html
---

# RESTource relations and customizations

Last week we’ve released RestfulControllersBundle, which adds Symfony2 controllers action naming
convention & ability to autogenerate routes from this proper action names. And as any proof of
concept, it has missing parts, which we mostly implemented now.

## Routes parameter customization

First of all, autogeneration is great. But what if you want to customize some route parameters or
even add new ones? Action annotations will help you to achieve this goal.

You can add requirements to route:

```php
/**
 * @restful:Route(requirements={"slug" = "[a-z]+"})
 */
public function getUserAction($slug)
{} // [GET]     /users/:slug
```

Change HTTP method:

```php
/**
 * @restful:Post
 */
public function cpostUserAction($slug)
{} // [POST]    /users/:slug/cpost
```

Or even change url:

```php
/**
 * @restful:Post("/users/:slug/rate_comment/:id", requirements={"slug" = "[a-z]+", "id" = "\d+"})
 */
public function rateUserCommentAction($slug, $id)
{} // [POST]     /users/:slug/rate_comment/:id
```

As you can see, you can mix options alltogether.

All annotations starts with `@restful:` followed by route keyword:

* `@restful:Route` - will not change autogenerated HTTP method. Use this if you simply want to specify route requirements or defaults.
* `@restful:Post` - will change required HTTP method to POST.
* `@restful:Put` - will change required HTTP method to PUT.
* `@restful:Get` - will change required HTTP method to GET.
* `@restful:Delete` - will change required HTTP method to DELETE.
* `@restful:Head` - will change required HTTP method to HEAD.

Read about HTTP methods purpose [here](https://www.packetizer.com/ws/rest.html).

## Relations

Second part is resource relations. Our basic `UsersController` source:

```php
class UsersController extends Controller
{
    public function getUsersAction()
    {} // [GET] /users

    public function getUserAction($slug)
    {} // [GET] /users/:slug

    public function newUsersAction()
    {} // [GET] /users/new

    public function postUsersAction()
    {} // [POST] /users

    public function putUserAction($slug)
    {} // [PUT] /users/:slug

    public function postUserCommentsAction($slug)
    {} // [POST] /users/:slug/comments

    public function voteUserCommentAction($slug, $id)
    {} // [PUT] /users/:slug/comments/:id/vote
}
```

All comments are placed on user page & we only need 2 separate actions to post new comment & to
vote for existing one. But what if we need more than 2 comment actions? Then it’s better to create
separate controller for comments `UserCommentsController`:

```php
class UserCommentsController
{
    public function newCommentsAction($slug)
    {} // [GET] /users/:slug/comments/new

    public function getCommentsAction($slug)
    {} // [GET] /users/:slug/comments

    public function postCommentsAction($slug)
    {} // [POST] /users/:slug/comments

    public function voteCommentAction($slug, $id)
    {} // [PUT] /users/:slug/comments/:id/vote
}
```

As you can see, we’ve get rid of User prefix, but `$slug` argument is still here. It’s because
`UserCommentsController` resource is child of the `UsersController` resource. But how to tell
Symfony2 about this relation? With new restful route collections loaders:

```yaml
# app/config/routing.yml
users:
  resources: restful:HelloBundle/Resources/config/restful_routes_collection.yml
```

or:

```yaml
# app/config/routing.yml
users:
  resources: restful:HelloBundle/Resources/config/restful_routes_collection.xml
```

This collections is almost same as default ones, but in addition, they know about restful relations. And you could specify resource relations in them like this:

```yaml
# HelloBundle/Resources/config/restful_routes_collection.yml
users:
  resource: restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UsersController

user_comments:
  resource: restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UserCommentsController
  parent:   users
```

or in xml:

```xml
<!-- HelloBundle/Resources/config/restful_routes_collection.xml -->
<?xml version="1.0" encoding="UTF-8" ?>

<routes xmlns="http://everzet.com/schema/restful_routing"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://everzet.com/schema/restful_routing http://everzet.com/schema/restful_routing-1.0.xsd">

    <import
        id="users"
        resource="restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UsersController" />

    <import
        id="user_comments"
        parent="users"
        resource="restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UserCommentsController" />

</routes>
```

and autogenerated routes still support prefixes:

```yaml
# HelloBundle/Resources/config/restful_routes_collection.yml
users:
  resource: restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UsersController
  prefix:   /resources/all

user_comments:
  resource: restful:Bundle\Everzet\RestfulControllersBundle\Tests\Fixtures\Controller\UserCommentsController
  parent:   users
  prefix:   /additional
```

This means, that described earlier voteCommentAction will generate
`/resources/all/users/:slug/additional/comments/:id/vote` url.

## Naming convention

Now let’s talk about idea behind this project.

## Why not listAction?

Many Rails adopters asked me why i’m not just copying RoR action naming scheme to Symfony2.
Because it’s not ideal & it has drawbacks, described in this PeepCode’s article (read it now).
Simple answer to “Why you not using Rails action names” is because HTTP+REST is already hard
enough to understand! There’s collection urls, object urls & even HTTP methods. Why complicate it
even more? Every new Rails developer must remember this table before it even can start to write
actions:

<table><tbody><tr><th>Method</th><th>URL</th><th>Action</th><th>Helper</th></tr><tr><td>GET</td><td>/pancakes</td><td class="action">index</td><td>pancakes_path</td></tr><tr class="odd"><td> GET</td><td>/pancakes/:id</td><td class="action">show</td><td>pancake_path(:id)</td></tr><tr><td>GET</td><td>/pancakes/new</td><td class="action">new</td><td>new_pancake_path</td></tr><tr class="odd"><td> POST</td><td>/pancakes</td><td class="action">create</td><td>pancakes_path</td></tr><tr><td>GET</td><td>/pancakes/:id/edit</td><td class="action">edit</td><td>edit_pancake_path(:id)</td></tr><tr class="odd"><td> PUT</td><td>/pancakes/:id</td><td class="action">update</td><td>pancake_path(:id)</td></tr><tr><td>DELETE</td><td>/pancakes/:id</td><td class="action">destroy</td><td>pancake_path(:id)</td></tr></tbody></table>

Are you serious? Why? Why you think `listAction` is better than `getUsers`? It’s not even shorter!
But `listAction` is definetly harder to read & understand which URL & HTTP method will call this
action, than `getUsers` counterpart.

So, main idea behind RestfulControllers is: Don’t complicate things. Write your actions by thinking about URLs only, not about freaking `route->action` match tables.

## Why i need to write Users word in every UsersController action?

Again, as i wrote above - because we don’t need to complicate things. I don'y like match tables &
the only alternative to them in this case is to use keywords like Collection & Object, like
proposed here:

```php
getCollection()
getObject($slug)
```

But i personaly think, that:

```php
getUsers()
getUser($slug)
```

is better. Better to read, better understand. Then why to complicate?

